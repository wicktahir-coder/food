<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes, viewport-fit=cover">
<title>Menu - FoodCloud</title>
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
:root{--primary:#ff4757;--primary-dark:#e63946;--card:#1a1f35;--card-hover:#252b45;--text:#f1f5f9;--muted:#94a3b8;--accent:#06b6d4}
*{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:rgba(255,71,87,0.2)}
html{scroll-behavior:smooth;-webkit-text-size-adjust:100%}
body{font-family:'Outfit',-apple-system,BlinkMacSystemFont,sans-serif;background:linear-gradient(135deg,#0a0e1a 0%,#1a1f35 100%);background-attachment:fixed;color:var(--text);min-height:100vh;position:relative;overflow-x:hidden;-webkit-font-smoothing:antialiased}
body::before{content:'';position:fixed;width:400px;height:400px;background:radial-gradient(circle,rgba(255,71,87,0.15),transparent);top:-200px;right:-200px;pointer-events:none;animation:float 8s ease-in-out infinite}
body::after{content:'';position:fixed;width:300px;height:300px;background:radial-gradient(circle,rgba(6,182,212,0.12),transparent);bottom:-150px;left:-150px;pointer-events:none;animation:float 10s ease-in-out infinite reverse}
@keyframes float{0%,100%{transform:translate(0,0)}33%{transform:translate(30px,-30px)}66%{transform:translate(-20px,20px)}}
header{background:rgba(26,31,53,0.85);backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);padding:12px 5%;display:flex;justify-content:space-between;align-items:center;position:sticky;top:0;z-index:100;border-bottom:1px solid rgba(255,255,255,0.1);box-shadow:0 4px 30px rgba(0,0,0,0.3);min-height:56px;gap:10px}
.logo{font-size:1.5rem;font-weight:700;background:linear-gradient(135deg,var(--primary),var(--accent));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;letter-spacing:-1px;flex-shrink:0}
.user-info{color:var(--muted);font-size:0.85rem;margin-right:auto;margin-left:15px}
.user-info strong{color:var(--text)}
.logout-btn{border-radius:25px;padding:8px 16px;cursor:pointer;font-weight:600;font-size:0.85rem;transition:all 0.3s;border:none;min-height:40px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.2);color:white}
.logout-btn:hover{background:rgba(255,255,255,0.1);transform:translateY(-2px)}
.container{max-width:1400px;margin:0 auto;padding:30px 20px 60px;position:relative;z-index:1}
.hero-section{text-align:center;margin-bottom:40px;padding:20px 10px}
.hero-section h1{font-size:2.2rem;font-weight:700;margin-bottom:12px;background:linear-gradient(135deg,var(--text),var(--accent));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;line-height:1.2}
.hero-section p{color:var(--muted);font-size:1rem;max-width:600px;margin:0 auto;line-height:1.6}
.cat-title{font-size:1.5rem;font-weight:700;margin:40px 0 20px;color:var(--text);display:flex;align-items:center;gap:12px}
.cat-title::before{content:'';width:4px;height:30px;background:linear-gradient(180deg,var(--primary),var(--accent));border-radius:10px}
.grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.card{background:var(--card);border-radius:16px;overflow:hidden;position:relative;transition:all 0.4s;border:1px solid rgba(255,255,255,0.05);display:flex;flex-direction:column}
.card:hover{transform:translateY(-6px);background:var(--card-hover);box-shadow:0 15px 30px rgba(0,0,0,0.4);border-color:rgba(255,71,87,0.3)}
.img-box{height:150px;position:relative;overflow:hidden}
.img-box img{width:100%;height:100%;object-fit:cover;transition:transform 0.5s}
.card:hover .img-box img{transform:scale(1.08)}
.price{position:absolute;top:10px;right:10px;background:rgba(0,0,0,0.85);backdrop-filter:blur(10px);padding:6px 12px;border-radius:20px;font-size:0.85rem;font-weight:700;color:var(--primary);z-index:2;border:1px solid rgba(255,71,87,0.3)}
.status-badge{position:absolute;top:10px;left:10px;padding:5px 10px;border-radius:20px;font-size:0.65rem;font-weight:700;text-transform:uppercase;z-index:2;backdrop-filter:blur(10px);max-width:calc(100% - 90px);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.st-available{background:rgba(34,197,94,0.9);color:#000}
.st-few{background:rgba(251,191,36,0.9);color:#000}
.st-sold{background:rgba(239,68,68,0.9);color:#fff}
.details{padding:14px;flex-grow:1}
.details h3{font-size:0.95rem;margin-bottom:6px;color:var(--text);font-weight:600;line-height:1.3;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}
.details p{color:var(--muted);font-size:0.8rem;line-height:1.4;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}
.loading{text-align:center;color:var(--muted);padding:50px 20px}
.error-message{text-align:center;color:var(--primary);padding:50px 20px;background:rgba(255,71,87,0.1);border-radius:12px;border:1px solid rgba(255,71,87,0.3)}
@media(max-width:360px){.grid{gap:10px}.img-box{height:130px}.details{padding:12px}.details h3{font-size:0.9rem}.user-info{display:none}}
@media(min-width:768px) and (max-width:1024px){.grid{grid-template-columns:repeat(3,1fr);gap:18px}.img-box{height:175px}}
@media(min-width:1025px){.grid{grid-template-columns:repeat(4,1fr);gap:22px}.img-box{height:190px}.details{padding:18px}}
</style>
</head>
<body>

<header>
  <div class="logo">FoodCloud.</div>
  <div class="user-info">Welcome, <strong id="userName">User</strong></div>
  <button class="logout-btn" onclick="logout()">Logout</button>
</header>

<div class="container">
  <div class="hero-section">
    <h1>Delicious Menu</h1>
    <p>Explore our handcrafted selection of premium dishes made with love</p>
  </div>
  <div id="root">
    <div class="loading">Loading Menu...</div>
  </div>
</div>

<script>
// REPLACE WITH YOUR MENU APPS SCRIPT URL
const MENU_API_URL = "https://script.google.com/macros/s/AKfycbwx1ctn_8AYTlFGvTZhRLs0pYCjtmjL7Cew5JDj63uZsb0sqpsahZHRjyq0-4ipNhn2/exec";

let menuData = [];

window.addEventListener('DOMContentLoaded', function() {
  checkAuthentication();
  displayUserName();
  fetchMenu();
});

function checkAuthentication() {
  const user = JSON.parse(localStorage.getItem('foodcloud_user') || '{}');
  if (!user.loggedIn) {
    window.location.href = 'login.html';
    return;
  }
  if (user.isAdmin) {
    window.location.href = 'admin.html';
  }
}

function displayUserName() {
  const user = JSON.parse(localStorage.getItem('foodcloud_user') || '{}');
  if (user.name) {
    document.getElementById('userName').textContent = user.name;
  }
}

function logout() {
  if (confirm('Are you sure you want to logout?')) {
    localStorage.removeItem('foodcloud_user');
    window.location.href = 'login.html';
  }
}

async function fetchMenu() {
  try {
    document.getElementById('root').innerHTML = '<div class="loading">Loading Menu...</div>';
    
    const response = await fetch(MENU_API_URL + '?action=getMenu&timestamp=' + new Date().getTime());
    
    if (!response.ok) throw new Error('Failed to fetch menu');
    
    const data = await response.json();
    console.log('Menu loaded:', data);
    
    if (Array.isArray(data)) {
      menuData = data;
      renderMenu();
    } else {
      throw new Error('Invalid data format');
    }
  } catch (error) {
    console.error('Error:', error);
    document.getElementById('root').innerHTML = 
      '<div class="error-message">⚠️ Failed to load menu. Please refresh the page.</div>';
  }
}

function renderMenu() {
  const root = document.getElementById('root');
  root.innerHTML = "";
  
  if (!menuData || menuData.length === 0) {
    root.innerHTML = '<div class="loading">No items in menu yet.</div>';
    return;
  }
  
  const categories = [...new Set(menuData.map(item => item.category))].filter(cat => cat);
  
  if (categories.length === 0) {
    root.innerHTML = '<div class="loading">No categories found.</div>';
    return;
  }
  
  categories.forEach(category => {
    const items = menuData.filter(item => item.category === category);
    let html = `<div class="cat-title">${category}</div><div class="grid">`;
    
    items.forEach(item => {
      let badgeClass = "st-available", badgeText = "Available";
      const status = String(item.status || 'available').toLowerCase().trim();
      
      if (status === "few") {
        badgeClass = "st-few";
        badgeText = "Few Left";
      } else if (status === "sold") {
        badgeClass = "st-sold";
        badgeText = "Sold Out";
      }
      
      const img = item.image || 'https://via.placeholder.com/300?text=Food';
      
      html += `
        <div class="card">
          <div class="img-box">
            <span class="price">₹${item.price || 0}</span>
            <span class="status-badge ${badgeClass}">${badgeText}</span>
            <img src="${img}" alt="${item.name || 'Food'}" onerror="this.src='https://via.placeholder.com/300?text=No+Image'">
          </div>
          <div class="details">
            <h3>${item.name || 'Untitled'}</h3>
            <p>${item.description || 'Delicious item from our menu'}</p>
          </div>
        </div>
      `;
    });
    
    html += '</div>';
    root.innerHTML += html;
  });
}

setInterval(fetchMenu, 30000);
</script>

</body>
</html>
